#!/bin/bash

GRC_CMD="/usr/bin/gridcoinresearchd -rpcuser=$GRC_USERNAME -rpcpassword=$GRC_PASSWD"
LOGFILE="$GRC_DATADIR/debug.log"

case $1 in

a|address)
	$GRC_CMD listaddressgroupings
	;;
	
b|balance)
	$GRC_CMD getbalance
	;;

c|cmd)
	$GRC_CMD "${@:2}"
	;;

d|clear|delete)
	clear
	echo "" > $LOGFILE
	clear
	;;

h|height)
	while true ; do
		$GRC_CMD getblockcount
		sleep 1
	done
	;;

i|init|start)
	if ! pgrep "gridcoinresearchd" ; then
		# Start Gridcoin client
		if [ -f $GRC_DATADIR/gridcoinresearch.conf ] ; then
			# .GridcoinResearch folder is correctly mounted
			/usr/bin/gridcoinresearchd -daemon -server -shrinkdebugfile -upnp -blocknotify='exec /grcupdate.sh' \
				&& echo "gridcoinresearchd initiated"
		else
			echo -e 'gridcoinresearch.conf NOT FOUND, aborting'
		fi
	else
		# Gridcoin client already running; "do nothing".
		# Uncomment below to specify what to do
		#/usr/bin/gridcoinresearchd $@
		echo -e 'gridcoinresearchd already running!'
	fi
	exit 0
	;;

k|kill)
	killall gridcoinresearchd
	echo Forcing gridcoinresearchd stop
	ps -e | grep gridcoin
	;;

l|log)
	clear
	tail -f -n 80 $LOGFILE
	clear
	;;

s|stop|exit)
	$GRC_CMD stop
	echo Stopping gridcoinresearchd
	ps -e | grep gridcoin
	;;

v|check|status)
	ps -e | grep gridcoin
	;;


*)
	echo "gridcoinresearchd command wrapper"
	echo "Usage: grc [options]"
	echo ""
	echo "options:"
	echo -e "\ta\tget Addresses"
	echo -e "\tb\tget Balance"
	echo -e "\tc\tCommand redirect: gridcoinresearchd (commands entered)"
	echo -e "\td\tLog clear and view"
	echo -e "\th\tget Height(blockcount)"
	echo -e "\ti\tDaemon start(init)"
	echo -e "\tk\tDaemon Kill(force stop)"
	echo -e "\tl\tLog view"
	echo -e "\ts\tDaemon Stop(exit)"
	echo -e "\tv\tDaemon Check"
	echo ""
	;;

esac
